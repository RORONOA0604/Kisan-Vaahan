<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kisan Vaahan | Admin - Products</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'kisan-green': '#22C55E',
            'kisan-dark': '#047857',
            'kisan-light': '#D1FAE5',
          },
          boxShadow: {
            'custom-3d': '0 10px 15px -3px rgba(34, 197, 94, 0.1), 0 4px 6px -2px rgba(34, 197, 94, 0.05)',
            'card-lift': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06)',
          },
        },
      },
    };
  </script>

  <style>
    /* small fix: ensure table cells wrap for long content */
    td, th { word-break: break-word; }
  </style>
</head>

<!-- Make body a column flex container so footer can sit at bottom -->
<body class="min-h-screen flex flex-col bg-gray-50 font-sans text-gray-800">

  <!-- HEADER -->
  <header class="bg-white shadow-md sticky top-0 z-30">
    <div class="flex justify-between items-center px-10 md:px-4 py-2 max-w-8xl mx-auto">
      <div class="flex items-center space-x-5 cursor-pointer">
        <img src="logo.png"
             alt="Kisan Vaahan Logo"
             class="h-24 w-24 object-contain transform hover:rotate-12 transition-transform duration-400" />
        <h1 class="text-4xl font-extrabold text-kisan-dark tracking-tight leading-none transform hover:scale-105 transition-transform duration-300">
          KISAN VAAHAN
        </h1>
      </div>

      <nav class="space-x-8 font-semibold text-2xl">
        <a href="marketplace.html" class="text-kisan-dark hover:text-kisan-green transition duration-300">Marketplace</a>
      </nav>
    </div>
  </header>

  <!-- PAGE WRAPPER (growable area) -->
  <div class="flex flex-1">
    <!-- SIDEBAR -->
    <aside class="w-64 bg-kisan-light border-r border-gray-200 p-6 flex flex-col justify-between">
      <div>
        <div class="mb-8 text-center">
          <img src="image.png" class="mx-auto h-16 w-16 rounded-full border-4 border-kisan-green" alt="Admin" />
          <h2 class="text-xl font-bold text-kisan-dark mt-2">Admin Panel</h2>
        </div>

         <nav class="space-y-10 font-semibold text-gray-700">
          <a href="admindashboardpage.html" class="flex items-center space-x-2 hover:text-kisan-green text-2xl">
            <span>Dashboard</span>
          </a>

          <a href="productspage.html"
             class="block px-4 py-3 rounded-lg shadow-sm border-l-4 border-kisan-green text-2xl font-semibold">
             Products
          </a>

          <a href="farmeruploadspage.html" class="flex items-center space-x-2 hover:text-kisan-green text-2xl"> Farmer Uploads</a>

          <a href="orderspage.html" class="flex items-center space-x-2 hover:text-kisan-green text-2xl">Orders</a>

          <a href="paymentpage.html" class="flex items-center space-x-2 hover:text-kisan-green text-2xl">Payments</a>
      </div>

      <button onclick="window.location.href='landingpage.html'" class="bg-red-500 text-white px-4 py-2 rounded-lg font-semibold mt-6">Log Out</button>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 p-10 overflow-auto">
      <div class="flex justify-between items-center mb-8">
        <div>
          <h2 class="text-4xl font-extrabold text-kisan-dark">Product Management</h2>
          <p class="text-gray-600 text-lg">View, edit, and manage your marketplace products</p>
        </div>

        <button onclick="window.location.href='addproductpage.html'"
                class="bg-kisan-green text-white px-6 py-2 rounded-lg font-semibold hover:bg-kisan-dark shadow-md">
          + Add New Product
        </button>
      </div>

      <!-- SEARCH + SORT BAR -->
      <div class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4 bg-white p-4 rounded-xl shadow">
        <div class="flex items-center gap-3 w-full md:w-1/2">
          <input id="searchBar"
                 type="text"
                 placeholder="Search by name or category..."
                 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-kisan-green focus:outline-none" />
        </div>

        <div class="flex items-center gap-3">
          <label class="font-semibold text-gray-700">Sort by:</label>
          <select id="sortSelect"
                  class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-kisan-green focus:outline-none">
            <option value="">Default</option>
            <option value="priceLow">Price: Low → High</option>
            <option value="priceHigh">Price: High → Low</option>
            <option value="category">Category (A → Z)</option>
          </select>
        </div>
      </div>

      <!-- PRODUCT TABLE -->
      <section class="bg-white rounded-2xl p-10 shadow-xl mt-8 border border-gray-200">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-3xl font-extrabold text-kisan-dark tracking-tight">My Product Listings</h3>
          <span id="productCount" class="text-lg font-semibold text-gray-500"></span>
        </div>

        <div class="overflow-x-auto rounded-xl border border-gray-200">
          <table class="min-w-full text-left text-lg">
            <thead class="bg-kisan-light text-kisan-dark uppercase tracking-wide font-semibold">
              <tr>
                <th class="p-4 border text-center w-56">Image</th>
                <th class="p-4 border">Name</th>
                <th class="p-4 border">Category</th>
                <th class="p-4 border text-center w-40">Price (₹)</th>
                <th class="p-4 border text-center w-40">Quantity</th>
                <th class="p-4 border text-center w-40">Actions</th>
              </tr>
            </thead>

            <tbody id="productTable" class="text-gray-800 text-lg"></tbody>
          </table>
        </div>
      </section>

    </main>
  </div> <!-- end page wrapper -->

  <!-- FOOTER (stays at bottom) -->
  <footer class="bg-kisan-dark text-white py-6 text-center mt-auto">
    <p class="text-lg">© 2025 Kisan Vaahan. All rights reserved.</p>
  </footer>

  <!-- DELETE CONFIRM POPUP -->
  <div id="confirmDelete" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-2xl shadow-lg text-center w-96">
      <h3 class="text-2xl font-bold text-kisan-dark mb-3">Delete Product?</h3>
      <p class="text-gray-600 mb-5">Are you sure you want to delete this product?</p>

      <div class="flex justify-center gap-4">
        <button onclick="cancelDelete()" class="px-4 py-2 border rounded-lg hover:bg-gray-100">Cancel</button>
        <button id="confirmDeleteBtn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">Delete</button>
      </div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script>
    const table = document.getElementById("productTable");
    const searchBar = document.getElementById("searchBar");
    const sortSelect = document.getElementById("sortSelect");
    let products = JSON.parse(localStorage.getItem("marketProducts")) || [];
    let deleteIndex = null;

    function loadProducts(filtered = products) {
      table.innerHTML = "";
      const count = document.getElementById("productCount");
      count.textContent = `Total Products: ${filtered.length}`;

      if (filtered.length === 0) {
        table.innerHTML = `<tr><td colspan="6" class="text-center p-5 text-gray-500">No products found </td></tr>`;
        return;
      }

      filtered.forEach((p, i) => {
        // support multiple property names (image, imageURL) for backwards compatibility
        const src = p.image || p.imageURL || p.imageURL1 || "https://via.placeholder.com/150";
        table.innerHTML += `
          <tr class="border-t hover:bg-gray-50 transition-all duration-300 hover:shadow-md">
            <td class="p-4 border text-center">
              <img src="${src}" alt="${p.name || ''}"
                   class="w-48 h-48 object-cover rounded-xl mx-auto border border-gray-200 shadow-sm">
            </td>
            <td class="p-4 border font-semibold text-gray-800 text-xl">${p.name || ''}</td>
            <td class="p-4 border text-gray-700">${p.category || ''}</td>
            <td class="p-4 border text-center font-semibold text-kisan-dark text-lg">₹${p.price || ''}</td>
            <td class="p-4 border text-center text-lg">${p.quantity || p.stock || ''}</td>
            <td class="p-4 border text-center text-lg">
              <button onclick="editProduct(${i})" class="text-kisan-green font-semibold hover:underline mr-4">Edit</button>
              <button onclick="confirmDeleteProduct(${i})" class="text-red-600 font-semibold hover:underline">Delete</button>
            </td>
          </tr>`;
      });
    }

    function editProduct(index) {
      localStorage.setItem("editProductIndex", index);
      window.location.href = "editproductpage.html";
    }

    function confirmDeleteProduct(index) {
      deleteIndex = index;
      document.getElementById("confirmDelete").classList.remove("hidden");
    }

    function cancelDelete() {
      document.getElementById("confirmDelete").classList.add("hidden");
    }

    document.getElementById("confirmDeleteBtn").addEventListener("click", () => {
      if (deleteIndex !== null) {
        products.splice(deleteIndex, 1);
        localStorage.setItem("marketProducts", JSON.stringify(products));
        deleteIndex = null;
        cancelDelete();
        loadProducts();
      }
    });

    // Search
    searchBar.addEventListener("keyup", () => {
      const query = searchBar.value.toLowerCase();
      const filtered = products.filter(p =>
        (p.name || "").toLowerCase().includes(query) ||
        (p.category || "").toLowerCase().includes(query)
      );
      loadProducts(filtered);
    });

    // Sort
    sortSelect.addEventListener("change", () => {
      let sorted = [...products];
      if (sortSelect.value === "priceLow") {
        sorted.sort((a, b) => (Number(a.price) || 0) - (Number(b.price) || 0));
      } else if (sortSelect.value === "priceHigh") {
        sorted.sort((a, b) => (Number(b.price) || 0) - (Number(a.price) || 0));
      } else if (sortSelect.value === "category") {
        sorted.sort((a, b) => (a.category || '').localeCompare(b.category || ''));
      }
      loadProducts(sorted);
    });

    // initial render
    loadProducts();
  </script>

</body>
</html>
