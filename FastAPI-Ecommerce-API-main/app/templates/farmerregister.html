<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create Farmer Account | Kisan Vaahan</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          'kisan-green': '#22C55E',
          'kisan-dark': '#047857',
          'kisan-light': '#D1FAE5',
        }
      }
    }
  }
  </script>
</head>
<body class="bg-gray-50 font-sans text-gray-800" style="zoom: 70%; overflow-x: hidden;">

<header class="bg-white shadow-md sticky top-0 z-30 py-3">
  <div class="flex justify-between items-center px-10 md:px-4 py-1 max-w-8xl mx-auto">
    <div class="flex items-center space-x-5 cursor-pointer">
      <img src="{{ url_for('static', path='logo.png') }}" alt="Kisan Vaahan Logo" class="h-24 w-24" />
      <h1 class="text-4xl font-extrabold text-kisan-dark">KISAN VAAHAN</h1>
    </div>
  </div>
</header>

<section class="flex justify-center items-center min-h-screen px-6">
  <div class="bg-white w-full max-w-md shadow-xl rounded-xl p-10 border border-gray-200">
    <h2 class="text-3xl font-extrabold text-center text-kisan-dark">Create Farmer Account</h2>
    <p class="text-center text-gray-600 mt-2">Join us and sell your fresh products directly to consumers</p>

    <form id="farmerRegisterForm" class="mt-10 space-y-6" autocomplete="on">
      <div>
        <label class="block text-sm font-semibold text-gray-700">Full Name</label>
        <input name="full_name" id="full_name" type="text"
               class="w-full mt-2 p-3 border rounded-lg focus:ring-2 focus:ring-kisan-green"
               placeholder="Your full name" required>
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700">Phone Number</label>
        <input name="phone" id="phone" type="tel"
               class="w-full mt-2 p-3 border rounded-lg focus:ring-2 focus:ring-kisan-green"
               placeholder="+91 98765 43210" required>
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700">Location / Village</label>
        <input name="location" id="location" type="text"
               class="w-full mt-2 p-3 border rounded-lg focus:ring-2 focus:ring-kisan-green"
               placeholder="Your village / city" required>
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700">Password</label>
        <input name="password" id="password" type="password"
               class="w-full mt-2 p-3 border rounded-lg focus:ring-2 focus:ring-kisan-green"
               placeholder="Create password" required>
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700">Confirm Password</label>
        <input name="confirm_password" id="confirm_password" type="password"
               class="w-full mt-2 p-3 border rounded-lg focus:ring-2 focus:ring-kisan-green"
               placeholder="Re-enter password" required>
      </div>

      <p id="regError" class="text-sm text-red-600 hidden"></p>

      <button type="submit"
        class="w-full bg-kisan-green text-white py-3 rounded-lg text-lg font-bold hover:bg-kisan-dark transition">
        Create Account
      </button>
    </form>

    <p class="text-center text-sm text-gray-700 mt-6">
      Already have an account?
      <a href="{{ url_for('farmer_login') }}" class="text-kisan-dark font-semibold hover:underline">Login â†’</a>
    </p>
  </div>
</section>

<!-- FOOTER -->
<footer class="bg-kisan-dark text-white py-12 text-center" style="zoom: 70%; overflow-x: hidden;">
  <div class="max-w-6xl mx-auto px-6">
    <h4 class="font-bold text-xl mb-4">Kisan Vaahan</h4>
    <div class="space-x-6 text-sm mb-6">
      <a href="{{ url_for('landing_page') }}" class="hover:text-kisan-green transition duration-300">Home</a>
      <a href="{{ url_for('about') }}" class="hover:text-kisan-green transition duration-300">About Us</a>
      <a href="{{ url_for('contact') }}" class="hover:text-kisan-green transition duration-300">Contact Us</a>
    </div>

    <p class="mt-4 text-lg">KisanVaahan Corporate Office, Bengaluru, Karnataka</p>
    <p class="mt-2 text-lg">ðŸ“ž <span class="text-kisan-green">+91 9742482379</span> | âœ‰ <span class="text-kisan-green">customercare@kisanvaahan.in</span></p>
    
    <div class="border-t border-white/20 mt-8 pt-4">
      <p class="text-lg text-gray-400">Â© 2025, KisanVaahan. All rights reserved.</p>
      <div class="space-x-4 text-lg mt-1">
        <a href="{{ url_for('contact') }}" class="hover:text-kisan-green transition duration-300">Privacy Policy</a>
        <a href="{{ url_for('contact') }}" class="hover:text-kisan-green transition duration-300">Terms of Service</a>
      </div>
    </div>
  </div>
</footer>

<script>
document.getElementById("farmerRegisterForm").addEventListener("submit", async function(e) {
  e.preventDefault();
  const errEl = document.getElementById("regError");
  errEl.classList.add("hidden");
  errEl.textContent = "";

  const form = e.target;
  const full_name = form.elements["full_name"].value.trim();
  const phone = form.elements["phone"].value.trim();
  const location = form.elements["location"].value.trim();
  const password = form.elements["password"].value;
  const confirm_password = form.elements["confirm_password"].value;

  if (!full_name || !phone || !location || !password || !confirm_password) {
    errEl.textContent = "Please fill all fields.";
    errEl.classList.remove("hidden");
    return;
  }

  if (password !== confirm_password) {
    errEl.textContent = "Passwords do not match.";
    errEl.classList.remove("hidden");
    return;
  }

  const payload = {
    full_name,
    username: phone,   // use phone as username for farmer
    email: null,       // optional: no email provided
    phone,
    address: location,
    password,
    user_type: "farmer"
  };

  try {
    const res = await fetch("/auth/signup", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const text = await res.text();
    let body = null;
    try { body = JSON.parse(text); } catch(_) { body = null; }

    if (!res.ok) {
      const message = body?.detail ? JSON.stringify(body.detail) : (body?.message || text || `Signup failed: ${res.status}`);
      errEl.textContent = message;
      errEl.classList.remove("hidden");
      return;
    }

    alert("Farmer account created successfully!");
    window.location.href = "{{ url_for('farmer_login') }}";
  } catch (err) {
    console.error(err);
    errEl.textContent = "Network error. Try again.";
    errEl.classList.remove("hidden");
  }
});
</script>
</body>
</html>
